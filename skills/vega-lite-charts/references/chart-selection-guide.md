# 图表类型选择指南

本文档提供详细的图表类型选择逻辑，帮助根据数据特征和用户需求自动选择最合适的图表类型。

## 快速决策树

```
用户需求
    ├─ 地理位置相关 → china-map（中国地图）
    ├─ 需要展示占比/构成 → pie-chart（饼图）
    ├─ 需要分类定位/象限分析 → quadrant-chart（四象限图）
    ├─ 正负对比/增长变化 → gain-loss-analysis（得失分析）
    └─ 多品牌对比/竞争格局 → competitive-landscape（竞争格局图）
```

## 详细选择逻辑

### 1. 中国地图 (china-map)

**触发条件：**
- 提到地理位置关键词：省份、城市、地域、区域、地图、分布
- 数据包含省份/城市名称
- 需要展示地理分布模式

**数据特征：**
- 必须包含地理位置字段（省份名、城市名）
- 数值字段（可选）：销售额、覆盖率、市占率等

**用户表达示例：**
- "生成中国地图"
- "各省份销售分布"
- "地域数据可视化"
- "冠军品牌地图"
- "省份热力图"

**适用场景：**
- 省份销售数据分布
- 城市市场覆盖分析
- 区域业绩热力图
- 多品牌地理分布对比

---

### 2. 饼图 (pie-chart)

**触发条件：**
- 提到占比、构成、百分比、份额
- 关注整体与部分的关系
- 数据类别较少（建议 2-8 个）

**数据特征：**
- 一个分类字段（品牌、类别等）
- 一个数值字段（销售额、份额等）
- 数据关注"占整体的比例"

**用户表达示例：**
- "生成饼图"
- "市场份额分布"
- "销售构成"
- "各品牌占比"
- "预算分配"

**适用场景：**
- 市场份额分布
- 销售构成分析
- 预算分配展示
- 人口统计分类

**不适用场景：**
- 类别数量超过 10 个（建议用柱状图）
- 需要对比多个时期（建议用竞争格局图）
- 数据有正负值（饼图不支持负值）

---

### 3. 四象限图 (quadrant-chart)

**触发条件：**
- 提到象限、矩阵、分类、定位
- 需要根据两个指标划分品牌/产品
- 波士顿矩阵分析

**数据特征：**
- 一个分类字段（品牌、产品名）
- 两个数值字段（X轴指标 + Y轴指标）
- 两个指标都需要对比分析

**用户表达示例：**
- "生成四象限图"
- "波士顿矩阵"
- "品牌分类定位"
- "象限分析"
- "按增长率和份额分类"

**适用场景：**
- 品牌定位分析（如波士顿矩阵）
- 产品分类（按增长率、市场份额）
- 客户分类（按价值、活跃度）
- 项目评估（按风险、收益）

**象限含义（标准波士顿矩阵）：**
- 右上（明星）：高增长 + 高份额
- 左上（潜力）：高增长 + 低份额
- 右下（成熟）：低增长 + 高份额
- 左下（衰退）：低增长 + 低份额

---

### 4. 得失分析柱状图 (gain-loss-analysis)

**触发条件：**
- 提到增长、变化、对比、得失、正负
- 数据有正负值
- 需要对比不同时期的变化

**数据特征：**
- 一个分类字段（品牌、产品、类目）
- 一个数值字段（增长率、变化值）
- 数值可以是正数或负数

**用户表达示例：**
- "生成柱状图"（注意：需结合上下文判断）
- "对比增长"
- "得失分析"
- "市场份额变化"
- "同比增长"
- "哪些品牌增长，哪些下跌"

**适用场景：**
- 品牌份额同比变化
- 产品销售增长对比
- 类目贡献度变化
- 业绩涨跌分析

**版本选择：**
- **简化版**（推荐）：无坐标轴，细柱子，适合演示报告
- **完整版**：完整坐标轴，适合详细数据分析

**询问用户话术：**
```
需要生成得失分析图，请选择版本：
1. 简化版（推荐）：无坐标轴，细柱子，品牌标签智能定位，视觉更简洁
2. 完整版：完整坐标轴，标准柱子，适合详细数据分析
```

---

### 5. 竞争格局分析图 (competitive-landscape)

**触发条件：**
- 提到竞争格局、多品牌对比、市场份额变化
- 需要展示多个品牌在不同时期的份额对比
- 堆叠柱状图、分组柱状图

**数据特征：**
- 三个字段：时期、品牌/集团、份额
- 需要对比多个时期（至少 2 个）
- 关注市场结构和变化趋势

**用户表达示例：**
- "竞争格局分析"
- "多品牌市场份额对比"
- "堆叠柱状图"
- "各品牌份额变化"
- "CR5、CR10 集中度分析"

**图表类型选择：**

| 图表类型 | 适用场景 | 优点 | 缺点 |
|---------|---------|------|------|
| **百分比堆叠柱状图**（推荐） | 展示各品牌占比变化 | 清晰显示占比变化，总和为 100% | 无法看出总量变化 |
| **堆叠柱状图（绝对值）** | 展示总市场份额变化 + 各品牌份额 | 可以看出总量变化和结构变化 | 难以对比中间份额的品牌 |
| **分组柱状图**（并排） | 品牌数量少（<8个） | 最直观，容易对比各品牌 | 品牌多时横向拥挤 |

**适用场景：**
- 竞争格局分析（多个品牌/集团的市场份额对比）
- 市场份额变化趋势（不同时期对比）
- 集团/品牌排名变化（CR5、CR10等集中度分析）
- 市场结构演变（头部品牌份额变化）

---

## 决策流程图

```mermaid
graph TD
    A[开始: 用户需求] --> B{是否涉及地理位置?}
    B -->|是| CM[china-map]
    B -->|否| C{是否关注占比/构成?}
    C -->|是| PC[pie-chart]
    C -->|否| D{是否需要象限分类?}
    D -->|是| QC[quadrant-chart]
    D -->|否| E{数据是否有正负值?}
    E -->|是| GLA[gain-loss-analysis]
    E -->|否| F{是否需要多时期对比?}
    F -->|是| CL[competitive-landscape]
    F -->|否| G{其他线索}
    G -->|提到"柱状图"| GLA
    G -->|提到"份额"+"多个时期"| CL
    G -->|无法确定| ASK[询问用户]
```

## 模糊情况处理

当用户需求不够明确时，按以下优先级选择：

1. **询问用户**（最推荐）
   - 提供选项让用户选择
   - 说明各图表类型的适用场景

2. **根据关键词匹配**
   - 优先匹配触发词
   - 结合数据特征判断

3. **默认推荐**
   - 如果只是提到"生成图表"，建议询问
   - 如果提到具体数据结构，根据数据特征推荐

## 常见用户查询与图表映射

| 用户查询 | 推荐图表 | 理由 |
|---------|---------|------|
| "生成饼图" | pie-chart | 直接指定 |
| "各省份销售分布" | china-map | 涉及地理位置 |
| "市场份额占比" | pie-chart | 关注占比 |
| "品牌分类定位" | quadrant-chart | 需要分类 |
| "同比增长对比" | gain-loss-analysis | 正负对比 |
| "竞争格局分析" | competitive-landscape | 多品牌对比 |
| "生成柱状图" | gain-loss-analysis | 优先假设为得失分析 |
| "多品牌份额变化" | competitive-landscape | 多时期对比 |
| "波士顿矩阵" | quadrant-chart | 直接指定 |
| "哪些增长哪些下跌" | gain-loss-analysis | 正负对比 |

## 数据特征优先级

当用户没有明确指定图表类型时，根据数据特征判断：

1. **地理位置字段** → china-map
2. **正负数值** → gain-loss-analysis
3. **三个字段（时期+品牌+份额）** → competitive-landscape
4. **两个数值字段** → quadrant-chart
5. **单个数值字段 + 关注占比** → pie-chart
6. **无法确定** → 询问用户

## 注意事项

1. **用户明确指定图表类型时**，直接使用指定的图表
2. **存在歧义时**，优先询问用户而非猜测
3. **数据特征和关键词冲突时**，以用户明确表达的需求为准
4. **多种图表都适用时**，向用户说明各选项，让用户选择
